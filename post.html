<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gabriel Montes | Technical Post</title>
  <link rel="stylesheet" href="style.css">
  
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>
  
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>

  <nav>
      <div class="container">
          <a href="index.html" class="logo-link" style="text-decoration: none;">
              <span class="logo">G.MONTES</span>
          </a>
          <ul>
              <li><a href="index.html">About</a></li> 
              <li><a href="experience.html">R&eacute;sum&eacute;</a></li>
              <li><a href="technical_blog.html">Technical Blog</a></li>
              <li><a href="personal_blog.html">Personal Blog</a></li>
          </ul>
      </div>
  </nav>

  <main class="container">
    <article id="post">Loading content...</article>
  </main>

  <script>
    const file = new URLSearchParams(location.search).get('file');
    
    if (!file) {
        document.getElementById('post').innerText = 'No file specified.';
    } else {
        fetch(file + '?v=' + Date.now())
          .then(r => r.ok ? r.text() : Promise.reject("File not found"))
          .then(text => {
            // STEP 1: Protection Loop
            // We tell marked to treat $...$ and $$...$$ as plain text blocks
            // so it doesn't parse underscores or backslashes inside them.
            marked.use({
              extensions: [{
                name: 'math',
                level: 'inline',
                start: (src) => src.indexOf('$'),
                tokenizer(src) {
                  const match = /^\$\$[\s\S]+?\$\$|^\$[\s\S]+?\$|^\$[^$\n]+?\$/.exec(src);
                  if (match) {
                    return { type: 'math', raw: match[0], text: match[0] };
                  }
                },
                renderer(token) { return token.text; }
              }]
            });

            // STEP 2: Render Markdown
            const rawHtml = marked.parse(text);
            
            // STEP 3: Sanitize and Inject
            // We allow MathJax tags to persist through sanitization
            document.getElementById('post').innerHTML = DOMPurify.sanitize(rawHtml);

            // STEP 4: Trigger MathJax
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([document.getElementById('post')]);
            }
          })
          .catch(e => {
              document.getElementById('post').innerText = 'Error: ' + e;
          });
    }
  </script>

  <footer>
      <div class="container">
          <p>&copy; 2026 Gabriel Montes</p>
      </div>
  </footer>
</body>
</html>